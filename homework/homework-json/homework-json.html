<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
		<script src="js/jquery-1.8.3.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

            //这个方法的思路是，用不同的数组存着不同的级别的数据，同一个数组中存同一个级别的obj，这样儿子跟儿子在一个数组里，父亲跟父亲在一个数组里
            //然后去存着父亲的那个数组里找儿子对应的父亲，将儿子插入对应的父亲的children中
            //最后插入成功之后再把相应的数组按照sort字段排序
            $.getJSON("1481882816867.json",function  (result)  {
                var  Data=[];
                //这是儿子找父亲的方法
                function  classify(obj)  {
                    //先判断最大的级别是哪一级    就要生成多少个数组
                    var  maxlevel  =  1;
                    $.each(obj,function  (i,kidobj)  {
                        if  (maxlevel<kidobj.level){
                            maxlevel=kidobj.level
                        }
                    });
                    //                  生成maxlevel个数组用来存放不同级别数据
                    var  level  =  [];
                    for(i=0;i<maxlevel;i++){
                        level[i]=[];
                        $.each(obj,function  (j,kidobj)  {
                            if  (kidobj.level==i+1){
                                level[i].push(kidobj)
                            }
                        })
                    }
                    //                  现在level[0]下存的就是所有的一级    level[1]下存的是所有的二级  如果有了三级那么会生成一个level[2]存着所有的三级
                    //                  然后就是要在所有的level[0]下找level[1]的父亲
                    $.each(obj,function  (j,  kidobj)  {
                        var  Level  =  kidobj.level;
                        var  parent  =  kidobj.parentId;
                        if  (Level>1){
                            //这里要用Level-1-1是为了进入存着他父亲的那个数组里    存Level1的那个数组是level[0]  存Level2的那个数组是level[1]
                            //                                  所以为了找到存着当前级别的父亲的那个数组    就要-1-1
                            $.each(level[Level-1-1],function  (n,  kidlevel)  {
                                if  (kidlevel.id==parent){
                                    if  (kidlevel.children==undefined){
                                        kidlevel.children=[]
                                        kidlevel.children.push(kidobj)
                                    }else{
                                        kidlevel.children.push(kidobj)
                                    }
                                }
                            })
                            Data  =  level[0];
                        }
                    })
                    resize(Data)
                }
                //这是给数组排序的方法
                function  resize(arr)  {
                    //                  如果只有一个  没有必要排序
                    if  (arr.length>1)  {
                        arr.sort(function  (a,  b)  {
                            return  a.sort  -  b.sort;
                        })
                    }
                    //                  如果有孩子，再调用这个方法
                    $.each(arr,function  (i,  kidarr)  {
                        if  (kidarr.children!==undefined){
                            resize(kidarr.children)
                        }
                    })
                }
                classify(result.data)
                resize(Data)
                console.log(Data)

            })
		</script>
	</body>
</html>
